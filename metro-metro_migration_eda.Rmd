---
title: "Exploration with CSVs"
author: "Malia Cortez"
date: "2024-08-11"
output: html_document
---

```{r setup, include=FALSE}
# data manipulation and reading
library(dplyr)
library(tidyverse)
library(tidyr)
library(stringr)
library(data.table)
library(readxl)
library(tigris)

# statistics
library(stats)

# mapping and plotting
library(ggplot2)
library(terra)
library(mapdeck)
library(mapboxapi)
library(sf)

# modeling
library(tree)
library(randomForest)
library(randomForestExplainer)
library(keras)

# extracting survey/IPUMS/census data
#library(survey)
#library(srvyr)
library(ipumsr)
library(tidycensus)
```

## Load Data
- Flows from Seattle-Tacoma-Bellevue metro area. 
- Changes from 2010 to 2020.
- Flows in 2020.
```{r cars}
race <- read.csv("data/race_2010-2020.csv")
housing <- read.csv("data/msa_med_housing_2011-2020.csv")
migrations <- read.csv("data/sea_mig_2020.csv")

# load in pop data eventually...
```

## Race Data Exploration
Lots of movement to the South for Black populations between 2010 and 2020 (ATL GA, Dallas FT Worth + Houston TX), with DC in 3rd place.
```{r}
# race data
head(race)

metro_race <- race %>% 
  filter(str_detect(CBSA, "Metro"))

# which msa saw most positive change in Black pop?
ggplot(metro_race %>% 
         arrange(desc(chg_black_2010_2020)) %>% 
         slice_head(n = 10),
       aes(x = reorder(CBSA, chg_black_2010_2020),
           y = chg_black_2010_2020)) +
  geom_bar(stat = "identity") +
  labs(title = "Metro Areas with Most Positive Change in Black Population",
       x = "MSA",
       y = "Value") +
  coord_flip()

# which msa saw most negative change in Black pop?
ggplot(metro_race %>% 
         arrange(chg_black_2010_2020) %>% 
         slice_head(n = 10),
       aes(x = reorder(CBSA, -chg_black_2010_2020),
           y = chg_black_2010_2020)) +
  geom_bar(stat = "identity") +
  labs(title = "Metro Areas with Most Negative Change in Black Population",
       x = "MSA",
       y = "Value") +
  coord_flip()
```
# Housing Data Exploration
California metro areas dominated in terms of increasing housing value (Boulder CO in 8th place). Interestingly, areas in Puerto Rico seem to be experiencing increasingly diminished median housing values, with East Stroudsburg PA in 9th and Peoria, IL in 10th (though, with non-negative housing value increase).
```{r}
# housing data
head(housing)

metro_housing <- housing %>% 
  filter(str_detect(NAME_E.y, "Metro"))

# which areas saw most positive change in housing? Positive?
# would like to see more updated data, Seattle's had some huge changes recently
ggplot(metro_housing %>% 
         arrange(desc(housing_chg)) %>% 
         slice_head(n = 10),
       aes(x = reorder(NAME_E.y, housing_chg),
           y = housing_chg)) +
  geom_bar(stat = "identity") +
  labs(title = "Metro Areas with Most Positive Change in Housing (Value Increasing)",
       x = "MSA",
       y = "Value") +
  coord_flip()

# most negative change?
ggplot(metro_housing %>% 
         arrange(housing_chg) %>% 
         slice_head(n = 10),
       aes(x = reorder(NAME_E.y, -housing_chg),
           y = housing_chg)) +
  geom_bar(stat = "identity") +
  labs(title = "Metro Areas with Most Negative Change in Housing",
       x = "MSA",
       y = "Value") +
  coord_flip()
```
## Migration Data Exploration
```{r}
# migration data
migrations <- migrations %>% 
  filter(FULL2_NAME != "Outside Metro Area within U.S. or Puerto Rico") %>% 
  select(-c(j, k))


ggplot(migrations %>% 
         arrange(desc(estimate)) %>% 
         slice_head(n = 10),
       aes(x = reorder(FULL2_NAME, estimate),
           y = estimate)) +
  geom_bar(stat = "identity") +
  labs(title = "Metro Areas with Most Movers from Seattle-Tacoma-Bellevue",
       x = "MSA",
       y = "Value") +
  coord_flip()
```

